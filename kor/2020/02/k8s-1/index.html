<!doctype html><html lang=ko prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#"><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=description content><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=keywords content><meta property="og:type" content="article"><meta property="og:description" content><meta property="og:title" content="쿠버네티스로 P2P 게임 테스트하기"><meta property="og:site_name" content="플라네타리움 엔지니어링 스낵"><meta property="og:image" content="https://snack.planetarium.dev/1/01/k8s-1/comparison.png"><meta property="og:url" content="https://snack.planetarium.dev/kor/2020/02/k8s-1/"><meta property="og:locale" content="ko"><meta property="article:published_time" content="2020-02-20"><meta property="article:modified_time" content="2020-02-20"><meta name=twitter:card content="summary"><meta name=twitter:site content="@"><meta name=twitter:creator content="@"><meta name=twitter:title content="쿠버네티스로 P2P 게임 테스트하기 | 플라네타리움 엔지니어링 스낵"><meta name=twitter:description content="안녕하세요, 플라네타리움에서 Libplanet을 개발하고 있는 문성원입니다. 작년 12월 16일부터 2주일간, 저희가 만들고 있는 완전 탈중앙 MMORPG인 나인 크로니클의 알파 테스트가 있었는데요. 오늘은 그 준비를 위해 쿠버네티스(Kubernetes)에 헤드리스 게임을 배포한 경험을 공유해보려고 합니다.
어떤 게 필요한가요?
Libplanet으로 개발된 게임은 블록체인 노드라고 할 수 있는데, 이는 나인 크로니클도 마찬가지입니다. 즉 모든 게임 클라이언트는 그 자체로 일반적인 게임 서버와 비슷한 역할(데이터 저장, 판정)을 온전히 수행할 수 있습니다. 이러한 P2P 환경에서 게임 환경과 최대한 유사하게 테스트하기 위해서는, 이러한 게임 클라이언트를 동시에 많이 실행하여 테스트할 필요가 있었습니다.|"><meta name=twitter:image:src content><meta name=twitter:domain content="https://snack.planetarium.dev/kor/2020/02/k8s-1/"><title>쿠버네티스로 P2P 게임 테스트하기</title>
<link rel=canonical href=https://snack.planetarium.dev/kor/2020/02/k8s-1/><link rel=alternate href=https://snack.planetarium.dev/eng/2020/02/k8s-1/ hreflang=en title="Testing P2P Game with Kubernetes"><link href=https://snack.planetarium.dev/index.xml rel=alternate type=application/atom+xml title="쿠버네티스로 P2P 게임 테스트하기"><link rel=stylesheet href=https://unpkg.com/tachyons@4.10.0/css/tachyons.min.css><link rel=stylesheet href=https://snack.planetarium.dev/css/style.min.1a35efb5c5da4fd20bd2ec86458da5ee7cc1cfc81c4f107944b5e0fc59a3d809.css integrity="sha256-GjXvtcXaT9IL0uyGRY2l7nzBz8gcTxB5RLXg/Fmj2Ak="><script async src="https://www.googletagmanager.com/gtag/js?id=UA-132504786-2"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-132504786-2")</script><link rel=icon href=/favicon-32x32.png type=image/png sizes=32x32><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=apple-touch-icon href=/apple-touch-icon.png></head><body class="sans-serif w-90 w-60-ns center center-ns mv2 mv5-ns" itemscope itemtype=http://schema.org/Article><a href=https://snack.planetarium.dev/kor/ id=site-title class="b bb bw1 pb1 no-underline dark-gray">플라네타리움 엔지니어링 스낵</a><section id=main class=mt5><h1 itemprop=name id=title class=mb1>쿠버네티스로 P2P 게임 테스트하기</h1><div class="f6 gray dib-ns"><time itemprop=datePublished datetime=2020-02-20>2020년 2월 20일
</time>(<strong></strong>
&bull;
<a href=https://snack.planetarium.dev/eng/2020/02/k8s-1/ hreflang=en title="Testing P2P Game with Kubernetes" class=gray>English</a>)</div><article itemprop=articleBody id=content class="w-100 lh-copy"><p>안녕하세요, <a href=https://planetariumhq.com>플라네타리움</a>에서 <a href=https://libplanet.io>Libplanet</a>을 개발하고 있는 문성원입니다. 작년 12월 16일부터 2주일간, 저희가 만들고 있는 완전 탈중앙 MMORPG인 <a href=https://nine-chronicles.com>나인 크로니클</a>의 알파 테스트가 있었는데요. 오늘은 그 준비를 위해 <a href=https://kubernetes.io/>쿠버네티스</a>(Kubernetes)에 헤드리스 게임을 배포한 경험을 공유해보려고 합니다.</p><h2 id=어떤-게-필요한가요>어떤 게 필요한가요?</h2><p>Libplanet으로 개발된 게임은 블록체인 노드라고 할 수 있는데, 이는 나인 크로니클도 마찬가지입니다. 즉 모든 게임 클라이언트는 그 자체로 일반적인 게임 서버와 비슷한 역할(데이터 저장, 판정)을 온전히 수행할 수 있습니다. 이러한 P2P 환경에서 게임 환경과 최대한 유사하게 테스트하기 위해서는, 이러한 게임 클라이언트를 동시에 많이 실행하여 테스트할 필요가 있었습니다.</p><h2 id=구체적인-희망-사항>구체적인 희망 사항</h2><ul><li>(많은 소프트웨어가 그렇듯이) 테스트 중인 게임 역시 필요에 따라 업데이트를 해야 할 때가 있습니다. 이때 실행된 모든 클라이언트를 돌면서 직접 업데이트하는 것은 그리 좋은 전략이 아닙니다.</li><li>한두 개를 켜서 실행하는 것은 개발자 개인이 쉽게 할 수 있는 일이지만, 우리는 그것보다 많은 게임 클라이언트를 테스트하고 싶습니다.</li><li>게임을 실행하긴 하지만, 많은 게임 클라이언트를 동시에 띄우는 것이기 때문에 각 게임 클라이언트의 화면을 보는 것은 그렇게 중요한 사항이 아닙니다. 즉 아무런 UI 없이 <a href=https://en.wikipedia.org/wiki/Headless_software>헤드리스</a>(headless)로 실행해도 괜찮습니다.</li></ul><h2 id=도커docker>도커(Docker)</h2><p>이런 사항을 만족하기 위해서는 여러 개의 프로세스를 동시에 실행하고 관리해야 했는데, 이때 사용한 솔루션이 <a href=https://docker.com>도커</a>(Docker)입니다. 도커는 리눅스 응용 프로그램을 실행환경째로 컨테이너화하여 실행하기 위해 많이 사용하는 솔루션입니다. 나인 크로니클은 첫 출시에서 리눅스를 주요 플랫폼으로 고려하고 있진 않지만, Unity를 사용해서 게임 개발을 하다보니 비교적 쉽게 리눅스용 빌드를 뽑을 수 있었고 (헤드리스 테스트 노드에선 크게 중요치 않은) UI 버그를 제외하면 동작도 크게 다르진 않았습니다.</p><h2 id=쿠버네티스kubernetes>쿠버네티스(Kubernetes)</h2><p>도커를 사용해서 게임 빌드를 어디서나 쉽게 돌릴 수 있게 컨테이너로 만들었지만 이걸로 끝은 아니었습니다. 저희의 목표는 어디까지나 많은 클라이언트를 손쉽게 실행/종료/업데이트하며 테스트 환경을 유지하는 것이니까요. 이를 위해서는 도커만으로는 부족했습니다.</p><p>가장 먼저 떠오른 방법은 <abbr title="Elastic Container Service"><a href=https://aws.amazon.com/ko/ecs/>ECS</a></abbr>와 같이 클라우드 공급자가 제공하는 실행 환경이었습니다. 이런 실행 환경들은 복잡한 워크플로우를 효율적으로 설정할 수 있게 디자인되어있지만, 바꾸어보면 설정이 복잡하며 테스트 환경에서만 사용한다면 많은 기능을 사용하지 않을 것이라는 생각이 들었습니다. 또한 특정 클라우드 공급자에 종속되는 테스트 환경이 이후 이전 작업등에 부담이 될 것 같기도 했고요.</p><figure><img src=/1/01/k8s-1/comparison.png alt="AWS 컨테이너 오케스트레이션 비교"><figcaption><p>AWS 컨테이너 오케스트레이션 비교</p></figcaption></figure><p>그래서 떠올린 대안이 쿠버네티스였습니다. 쿠버네티스는 저희가 ECS 같은 서비스를 통해서 하고 싶은 일을 공급자 중립적(Provider Agonistic)으로 할 수 있는 오픈소스 프로젝트입니다. 여러 종류의 복잡한 컨테이너를 손쉽게 띄우고 내리는 기능을 컨테이너 오케스트레이션이라고 하는데, 저희는 거의 같은 종류의 컨테이너(게임)를 여러 개 띄우고 싶은 것뿐이니 설정은 그리 복잡하지 않았습니다.</p><h2 id=다음-이야기>다음 이야기</h2><p>적다 보니 이야기가 많이 길어졌네요. 다음 시간에는 테스트를 위해 쿠버네티스를 어떻게 설정하고 클라우드 상에 배치하고 있는지 구체적인 절차에 대해 살펴보도록 하겠습니다.</p></article><script>(function(){if(!location.hash.match(/^#/))return;var t,n,s,a,o=document.getElementById("content"),r=window.decodeURIComponent(location.hash.substring(1)),i=document.getElementById(r),e=i.nodeName.match(/^H([123456])$/);if(!e||i.parentNode!==o)return;for(a=window.parseInt(e[1]),t=!1,s=0;s<o.childNodes.length;s++)n=o.childNodes[s],t?(e=n.nodeName.match(/^H([123456])$/),e&&window.parseInt(e[1])>=a&&(t=!1)):n===i&&(t=!0),!t&&!n.nodeName.match(/^#/)&&(n.className+=" dim")})()</script><div class=recruit><a href=https://planetariumhq.com>플라네타리움</a>은 게임에 특화된
오픈 소스 P2P 라이브러리 <a href=https://libplanet.io/>Libplanet</a>과,
그 위에서 중앙 서버 없는 온라인 게임
〈<a href=https://nine-chronicles.com/>나인 크로니클</a>〉을 만들고
있습니다. 저희와 흥미로운 기술적 도전을 함께 하실 분들을 모시고 있습니다.
지금 <a href=https://recruit.planetariumhq.com/>인재 영입 페이지</a>를
확인해주세요!</div><div itemprop=author class="fl tc mr3"><a href=https://github.com/longfin rel=author itemprop=url class="no-underline mid-gray b f6"><img src="https://www.gravatar.com/avatar/0b12cfcb4b1a472207af0e51f7d13a71?d=https://avatars.githubusercontent.com/longfin" itemprop=image class="w3 h3 br-100 mb1"><br>문성원</a></div></section><footer><div><p class="f6 gray mt6 lh-copy">&copy; 2019&ndash;2023
<a href=https://planetariumlabs.com/ style=color:inherit;text-decoration:inherit>Planetarium</a>.</p></div></footer></body></html>