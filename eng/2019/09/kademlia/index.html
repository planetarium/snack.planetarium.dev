<!doctype html><html lang prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#"><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=description content><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=keywords content><meta property="og:type" content="article"><meta property="og:description" content><meta property="og:title" content="Applying Kademlia Distributed Hash Table to Libplanet"><meta property="og:site_name" content="Planetarium Engineering Snack"><meta property="og:image" content="https://snack.planetarium.dev/og/eng.png"><meta property="og:url" content="https://snack.planetarium.dev/eng/2019/09/kademlia/"><meta property="og:locale" content><meta property="article:published_time" content="2019-09-27"><meta property="article:modified_time" content="2019-09-27"><meta name=twitter:card content="summary"><meta name=twitter:site content="@"><meta name=twitter:creator content="@"><meta name=twitter:title content="Applying Kademlia Distributed Hash Table to Libplanet | Planetarium Engineering Snack"><meta name=twitter:description content="Hello, I&rsquo;m Chanhyuck Ko of Planetarium Dev Team. In this post, I&rsquo;m going to take some time to briefly explain what Kademlia is, one of the distributed hash table techniques for efficiently configuring distributed P2P networks, and why it was applied to our project, Libplanet.
What is Kademlia? Distributed Hash Tables (DHT) store and manage data across nodes on a network. When locating data on a network, they play a major role in reducing each node’s load by finding the node that has that data first and then asking for a value.|"><meta name=twitter:image:src content><meta name=twitter:domain content="https://snack.planetarium.dev/eng/2019/09/kademlia/"><title>Applying Kademlia Distributed Hash Table to Libplanet</title>
<link rel=canonical href=https://snack.planetarium.dev/eng/2019/09/kademlia/><link rel=alternate href=https://snack.planetarium.dev/kor/2019/09/kademlia/ hreflang=ko title="Kademlia 분산 해시 테이블 적용기"><link href=https://snack.planetarium.dev/index.xml rel=alternate type=application/atom+xml title="Applying Kademlia Distributed Hash Table to Libplanet"><link rel=stylesheet href=https://unpkg.com/tachyons@4.10.0/css/tachyons.min.css><link rel=stylesheet href=https://snack.planetarium.dev/css/style.min.1a35efb5c5da4fd20bd2ec86458da5ee7cc1cfc81c4f107944b5e0fc59a3d809.css integrity="sha256-GjXvtcXaT9IL0uyGRY2l7nzBz8gcTxB5RLXg/Fmj2Ak="><script async src="https://www.googletagmanager.com/gtag/js?id=UA-132504786-2"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-132504786-2")</script><link rel=icon href=/favicon-32x32.png type=image/png sizes=32x32><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=apple-touch-icon href=/apple-touch-icon.png></head><body class="sans-serif w-90 w-60-ns center center-ns mv2 mv5-ns" itemscope itemtype=http://schema.org/Article><a href=https://snack.planetarium.dev/eng/ id=site-title class="b bb bw1 pb1 no-underline dark-gray">Planetarium Engineering Snack</a><section id=main class=mt5><h1 itemprop=name id=title class=mb1>Applying Kademlia Distributed Hash Table to Libplanet</h1><div class="f6 gray dib-ns"><time itemprop=datePublished datetime=2019-09-27>September 27, 2019
</time>(<strong>English</strong>
&bull;
<a href=https://snack.planetarium.dev/kor/2019/09/kademlia/ hreflang=ko title="Kademlia 분산 해시 테이블 적용기" class=gray>한국어</a>)</div><article itemprop=articleBody id=content class="w-100 lh-copy"><p>Hello, I&rsquo;m Chanhyuck Ko of Planetarium Dev Team. In this post, I&rsquo;m going to take some time to briefly explain what <a href=https://en.wikipedia.org/wiki/Kademlia>Kademlia</a> is, one of the <a href=https://en.wikipedia.org/wiki/Distributed_hash_table>distributed hash table</a> techniques for efficiently configuring distributed P2P networks, and why it was applied to our project, <a href=https://libplanet.io/>Libplanet</a>.</p><h2 id=what-is-kademlia>What is Kademlia?</h2><p>Distributed Hash Tables (DHT) store and manage data across nodes on a network. When locating data on a network, they play a major role in reducing each node’s load by finding the node that has that data first and then asking for a value.</p><p>Various DHT implementations store nodes in their own routing tables in different ways. So how does Kademlia implement a distributed hash table? Let me give you a quick example. Let&rsquo;s go back to 2008 and talk about Kim, a Korean American who lives in Los Angeles. He is visiting Korea to see his friend after a long time, and just got off at Incheon International Airport.</p><blockquote><p>I’d like to go to my friend&rsquo;s house, but I don&rsquo;t know where it is.</p></blockquote><p>Gee, I think Kim is lost. In 2019, he would have taken out his smartphone and entered the address, but in 2008, he doesn’t have one because it’s not yet popular. Kim takes a closer look at the only information, the address.</p><blockquote><p><em>1-91 Sejong-ro (street), Jongno-gu (district), Seoul (city)</em></p></blockquote><p>Without much choice, Kim first heads to Seoul city. And there, he goes up to people and asks them for directions, but not many know where the address is exactly. So, Kim changes his strategy and starts asking how to get to Jongno-gu. There are quite a few people who knows Jongno-gu, and after many twists and turns, Kim arrives at Jongno-gu. Now it&rsquo;s time to ask about Sejong-ro!</p><p>Although Kim didn&rsquo;t know the exact location of the address, he gradually narrowed it down and eventually reached his friend&rsquo;s house. Similar to Kim’s example, each peer on a Kademlia network also maintains and searches for peer information.</p><p>Peers of a network have virtual addresses. It&rsquo;s not a geographical address like <em>&ldquo;1-91 Sejong-ro, Jongno-gu, Seoul&rdquo;</em>, but a series of bytes assigned at random or by set rules. As for distance, it’s defined as an <a href=https://en.wikipedia.org/wiki/Exclusive_or#Computer_science>exclusive disjunction</a> of the address values of two peers, rather than the physical distance between the actual peers.</p><p>Instead of containing information from every peer on the network in their routing tables, peers using Kademlia protocol classify them according to the distance defined above and store only a limited number of peers per distance range. Peers with a distance of at least 2<sup>i</sup> and up to 2<sup>i+1</sup> are stored in the i-th row of the routing table. This optional storing of peer information in a routing table allows you to locate peer B by requesting information to a peer that is closest to B that you know, and then repeating this series of request until it leads to B.</p><h2 id=reason-for-applying-kademlia>Reason for Applying Kademlia</h2><p>To configure a P2P network that communicates without a server, communication between all peers must be guaranteed. But not all peers have to be directly connected to each other. Take a look at these three peers- A, B and C.</p><p>In a traditional Libplanet, we built a network like this. It was a configuration in which all the peers were connected.</p><figure><img src=1.png alt="All the peers are connected to each other."><figcaption><p>All the peers are connected to each other.</p></figcaption></figure><p>This is not a big deal when the network is small, but if you have, say 1,000 peers, or 10,000 peers, it&rsquo;s a lot of pressure every time you send that message to the network.</p><figure><img src=2.png alt="Peers overloaded with excessive transmission."><figcaption><p>Peers overloaded with excessive transmission.</p></figcaption></figure><p>Using Kademlia, each row of routing tables will consist of peers whose distances are within the same range. When transmitting data, you select and send message to all peers in each row of the routing table, and those peers will do the same for all peers in their own tables. Eventually, every peer on the network will be able to receive the message. In this way, when N peers are on the network, one peer will only send a message log(N) times, preventing the network load from being concentrated on one peer.</p><figure><img src=3.png alt="A Network transmitting messages."><figcaption><p>A Network transmitting messages.</p></figcaption></figure><h2 id=to-conclude>To Conclude</h2><p>In order to give users a sense that their actions are processing fast, you need to frequently create blocks of transactions that contain those actions. But the more frequently a block is created, the more network load a miner will receive. To ensure a stable network as its size grows, distributed hash tables had to be applied to Libplanet. In return, we were able to run a test and see that the network load on a single peer was reduced in a harsher setting.</p><p>If you have any questions about Kademlia distributed hash table or Libplanet, please visit our [Discord chatroom] and let’s chat!</p></article><script>(function(){if(!location.hash.match(/^#/))return;var t,n,s,a,o=document.getElementById("content"),r=window.decodeURIComponent(location.hash.substring(1)),i=document.getElementById(r),e=i.nodeName.match(/^H([123456])$/);if(!e||i.parentNode!==o)return;for(a=window.parseInt(e[1]),t=!1,s=0;s<o.childNodes.length;s++)n=o.childNodes[s],t?(e=n.nodeName.match(/^H([123456])$/),e&&window.parseInt(e[1])>=a&&(t=!1)):n===i&&(t=!0),!t&&!n.nodeName.match(/^#/)&&(n.className+=" dim")})()</script><div itemprop=author class="fl tc mr3"><a href=https://github.com/limebell rel=author itemprop=url class="no-underline mid-gray b f6"><img src="https://www.gravatar.com/avatar/e7b1079fc34b3ee9068d5d322aad9238?d=https://avatars.githubusercontent.com/limebell" itemprop=image class="w3 h3 br-100 mb1"><br>Chanhyuck Ko</a></div></section><footer><div><p class="f6 gray mt6 lh-copy">&copy; 2019&ndash;2023
<a href=https://planetariumlabs.com/ style=color:inherit;text-decoration:inherit>Planetarium</a>.</p></div></footer></body></html>