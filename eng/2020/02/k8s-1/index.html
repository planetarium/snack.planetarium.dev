<!doctype html><html lang=en prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#"><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=description content><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=keywords content><meta property="og:type" content="article"><meta property="og:description" content><meta property="og:title" content="Testing P2P Game with Kubernetes"><meta property="og:site_name" content="Planetarium Engineering Snack"><meta property="og:image" content="https://snack.planetarium.dev/1/01/k8s-1/comparison.png"><meta property="og:url" content="https://snack.planetarium.dev/eng/2020/02/k8s-1/"><meta property="og:locale" content="en"><meta property="article:published_time" content="2020-02-20"><meta property="article:modified_time" content="2020-02-20"><meta name=twitter:card content="summary"><meta name=twitter:site content="@"><meta name=twitter:creator content="@"><meta name=twitter:title content="Testing P2P Game with Kubernetes | Planetarium Engineering Snack"><meta name=twitter:description content="Hello, I am Swen Mun, Libplanet developer at Planetarium. From December 16th last year, we held a 2-week alpha test of Nine Chronicles, a fully decentralized MMORPG. Today, we&rsquo;re going to share our experience deploying headless games on Kubernetes.
What Did We Need?
A game developed with Libplanet is considered a blockchain node, and the same goes for Nine Chronicles. That is, every game client can play a role that is in itself similar to a typical game server (data storage, refereeing). To hold a test as close to a game environment in this P2P environment, we needed to run as many of these game clients at the same time.|"><meta name=twitter:image:src content><meta name=twitter:domain content="https://snack.planetarium.dev/eng/2020/02/k8s-1/"><title>Testing P2P Game with Kubernetes</title>
<link rel=canonical href=https://snack.planetarium.dev/eng/2020/02/k8s-1/><link rel=alternate href=https://snack.planetarium.dev/kor/2020/02/k8s-1/ hreflang=ko title="쿠버네티스로 P2P 게임 테스트하기"><link href=https://snack.planetarium.dev/index.xml rel=alternate type=application/atom+xml title="Testing P2P Game with Kubernetes"><link rel=stylesheet href=https://unpkg.com/tachyons@4.10.0/css/tachyons.min.css><link rel=stylesheet href=https://snack.planetarium.dev/css/style.min.1a35efb5c5da4fd20bd2ec86458da5ee7cc1cfc81c4f107944b5e0fc59a3d809.css integrity="sha256-GjXvtcXaT9IL0uyGRY2l7nzBz8gcTxB5RLXg/Fmj2Ak="><script async src="https://www.googletagmanager.com/gtag/js?id=UA-132504786-2"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-132504786-2")</script><link rel=icon href=/favicon-32x32.png type=image/png sizes=32x32><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=apple-touch-icon href=/apple-touch-icon.png></head><body class="sans-serif w-90 w-60-ns center center-ns mv2 mv5-ns" itemscope itemtype=http://schema.org/Article><a href=https://snack.planetarium.dev/eng/ id=site-title class="b bb bw1 pb1 no-underline dark-gray">Planetarium Engineering Snack</a><section id=main class=mt5><h1 itemprop=name id=title class=mb1>Testing P2P Game with Kubernetes</h1><div class="f6 gray dib-ns"><time itemprop=datePublished datetime=2020-02-20>February 20, 2020
</time>(<strong></strong>
&bull;
<a href=https://snack.planetarium.dev/kor/2020/02/k8s-1/ hreflang=ko title="쿠버네티스로 P2P 게임 테스트하기" class=gray>한국어</a>)</div><article itemprop=articleBody id=content class="w-100 lh-copy"><p>Hello, I am Swen Mun, <a href=https://libplanet.io>Libplanet</a> developer at <a href=https://planetariumhq.com>Planetarium</a>. From December 16th last year, we held a 2-week alpha test of <a href=https://nine-chronicles.com>Nine Chronicles</a>, a fully decentralized MMORPG. Today, we&rsquo;re going to share our experience deploying headless games on <a href=https://kubernetes.io/>Kubernetes</a>.</p><h2 id=what-did-we-need>What Did We Need?</h2><p>A game developed with Libplanet is considered a blockchain node, and the same goes for Nine Chronicles. That is, every game client can play a role that is in itself similar to a typical game server (data storage, refereeing). To hold a test as close to a game environment in this P2P environment, we needed to run as many of these game clients at the same time.</p><p>Although we will be running the games, we’re focused on executing as many game clients at the same time so it&rsquo;s not that important to see the screen of each client. Therefore, we’re OK with running headless without any UI.</p><h2 id=test-conditions>Test Conditions</h2><ul><li>Games under testing (as with software in general) may need to be updated as necessary. It&rsquo;s not a good strategy to go around all running clients and update them one by one.</li><li>While it&rsquo;s easy for an individual developer to run one or two clients, we want to test far more than just a handful.</li><li>Although we will be running the games, we’re focused on executing as many game clients at the same time so it&rsquo;s not that important to see the screen of each client. Therefore, we’re OK with running <a href=https://en.wikipedia.org/wiki/Headless_software>headless</a> without any UI.</li></ul><h2 id=docker>Docker</h2><p>To meet these conditions, we needed to run and manage multiple processes at the same time, and that led us to use <a href=https://docker.com>Docker</a>. Docker is a popular solution for containerizing and running Linux applications throughout your environment. Although we’re not considering Linux as a major platform for Nine Chronicle’s first launch, developing games with Unity has made it relatively easy to produce a build for Linux, and apart from minor UI bugs (which doesn&rsquo;t matter much for the headless test node), the behavior didn&rsquo;t change much.</p><h2 id=kubernetes>Kubernetes</h2><p>Even though we used a Docker to make a container that easily runs a game build, that wasn&rsquo;t the end. Our goal was to easily run/end/update many clients while maintaining a test environment. To do this, just using Docker wasn’t enough.</p><p>Our first option was the execution environment offered by cloud providers, such as <abbr title="Elastic Container Service"><a href="https://aws.amazon.com/ecs/?nc1=h_ls">ECS</a></abbr>. These execution environments are designed to efficiently set up complex workflows. But in other words, they&rsquo;re complex to set up and we wouldn’t be using a lot of functionality provided since we’re just using it in a test environment. Also, a test environment dependent on a particular cloud provider would likely to be a burden on future operations.</p><figure><img src=/1/01/k8s-1/comparison.png alt="AWS Container Orchestration Comparison"><figcaption><p>AWS Container Orchestration Comparison</p></figcaption></figure><p>So the alternative we came up with was Kubernetes. Kubernetes is an open-source project that allows us to do what we want similar to services like ECS while being Provider Agnostic. The feature of running and stopping complex containers is called container orchestration, and because we wanted to run multiple containers (games) of the same kind, the setup wasn&rsquo;t that complicated.</p><h2 id=coming-up>Coming Up</h2><p>Next time we&rsquo;ll take a look at the specific procedures for setting up the Kubernetes for testing and how to deploy it on the cloud.</p></article><script>(function(){if(!location.hash.match(/^#/))return;var t,n,s,a,o=document.getElementById("content"),r=window.decodeURIComponent(location.hash.substring(1)),i=document.getElementById(r),e=i.nodeName.match(/^H([123456])$/);if(!e||i.parentNode!==o)return;for(a=window.parseInt(e[1]),t=!1,s=0;s<o.childNodes.length;s++)n=o.childNodes[s],t?(e=n.nodeName.match(/^H([123456])$/),e&&window.parseInt(e[1])>=a&&(t=!1)):n===i&&(t=!0),!t&&!n.nodeName.match(/^#/)&&(n.className+=" dim")})()</script><div itemprop=author class="fl tc mr3"><a href=https://github.com/longfin rel=author itemprop=url class="no-underline mid-gray b f6"><img src="https://www.gravatar.com/avatar/0b12cfcb4b1a472207af0e51f7d13a71?d=https://avatars.githubusercontent.com/longfin" itemprop=image class="w3 h3 br-100 mb1"><br>Swen Mun</a></div></section><footer><div><p class="f6 gray mt6 lh-copy">&copy; 2019&ndash;2025
<a href=https://planetariumlabs.com/ style=color:inherit;text-decoration:inherit>Planetarium</a>.</p></div></footer></body></html>